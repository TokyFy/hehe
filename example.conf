# Configuration exemple pour webserv
# Ce fichier montre toutes les fonctionnalités supportées

# Premier serveur - Site principal
webserv_main {
   listen       127.0.0.1:8080;
   client_max_body_size      10M;
   
   # Pages d'erreur personnalisées
   error_page  404 /error_pages/404.html;
   error_page  500 /error_pages/500.html;
   error_page  403 /error_pages/403.html;

   # Location racine
   location / {
       root /www/;  
       allow_methods GET POST DELETE;
       autoindex false;
       index index.html;
   }

   # Location avec autoindex activé
   location /public/ {
       root /www/public/;  
       allow_methods GET POST DELETE;
       autoindex true;
       index index.html;
   }

   # Location avec upload
   location /upload/ {
       root /www/upload/;
       allow_methods POST;
       autoindex false;
       upload /uploadFolder/;
       index upload.html;
   }

   # Location avec CGI Python
   location /cgi-bin/ {
       root /www/cgi-bin/;
       allow_methods GET POST;
       autoindex false;
       index test.py;
       cgi /usr/bin/python3 .py;
   }

   # Location avec redirection
   location /old-page/ {
       root /www/;
       allow_methods GET;
       autoindex false;
       redirect 301 /new-page/;
       index index.html;
   }
}

# Deuxième serveur - API sur port différent
api_server {
   listen       127.0.0.1:3000;
   client_max_body_size      5M;
   
   error_page  404 /error_pages/404.html;
   error_page  500 /error_pages/500.html;

   location /api/ {
       root /www/api/;  
       allow_methods GET POST DELETE;
       autoindex false;
       index index.html;
   }

   # API avec CGI PHP
   location /api/php/ {
       root /www/api/php/;
       allow_methods GET POST;
       autoindex false;
       cgi /usr/bin/php-cgi .php;
       index index.php;
   }
}
